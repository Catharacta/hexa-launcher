# 六角形ランチャー 要件仕様（確定版）

概要  
未決だった設計選択はすべて推奨案で確定しました。本ファイルは実装フェーズに渡すための要件仕様書（MVP優先）です。

---

## 主要決定（サマリ）
- 座標系：cube 座標系（x,y,z; x+y+z=0）、UI は pointy-top（上下が尖った六角形）。  
- 辺クリック追加アルゴリズム：MVP は単純方式（origin + CUBE_DIR[edgeIndex] に新規セルを追加）。既に占有されている場合は追加拒否・エラー通知。  
- グループモデル：参照型（グループはセルIDの配列を保持）。  
- ショートカット解決：.lnk を正しく解析して target/args/workingDir を保存、UWP は AUMID 等で対応。  
- アイコン抽出とキャッシュ：ディスクキャッシュ＋メモリ LRU キャッシュ。  
- 永続化：MVP は JSON。保存は原子的。  
- 管理者昇格（UAC）：ショートカットに runAsAdmin フラグを保持。  
- 表示セル数：MVP は一度に最大30セルを表示（固定）。  
- テーマ：固定の SF/サイバーパンク風テーマ（MVP）。

---

## 詳細仕様

### 1) セル種別一覧（確定）
1. **ランチャー設定セル（LauncherSettingCell）**
   - 説明: ランチャー設定画面を開くためのセル。必ず1つ以上存在し、削除不可。
   - 振る舞い: クリック／Enterで設定画面を開く。

2. **ショートカットセル（ShortcutCell）**
   - 説明: 実行可能なショートカットを登録するセル（.lnk/.exe/URI/UWP 等）。
   - データフィールド:
     - `shortcut`: `{ kind: "file" | "lnk" | "uwp" | "uri", targetPath?, arguments?, workingDirectory?, aumid?, uri?, runAsAdmin?, warningLevel? }`
   - 挙動:
     - クリック／Enterで起動。runAsAdmin が true の場合は昇格 (UAC)。
     - **ドラッグ&ドロップ**: 既存のセルにドロップすると、そのセルにショートカットを登録/上書きする。
   - 受け入れ条件:
     - .lnk 登録時に target/args/workingDir を保持できること。

3. **グループセル（GroupCell）**
   - 説明: グループ（フォルダ）を参照するセル。
   - データフィールド: `groupId`
   - 挙動: クリック／Enterでグループビューを開き、現在ビューを置換。
   - 受け入れ条件: ネスト最大 5 層（設定で変更可）。

4. **未登録セル（UnregisteredCell）**
   - 説明: 何も登録されていないセル。
   - 挙動: クリックで登録メニューを開く（ショートカット登録/グループ作成等）。

5. **閉じるセル（CloseCell）**
   - 説明: ランチャーを閉じトレイに戻すための専用セル。必ず1つ以上存在し、削除不可。
   - 挙動: クリックで UI を閉じ、プロセスはトレイ常駐のままとする。

6. **戻るセル（BackCell）**
   - 説明: グループや任意のビューで上位階層に戻るためのセル。どの階層にも常に必ず1つ以上存在する（削除不可）。
   - 挙動: クリックまたは選択→Enter で親グループ／上位ビューへ遷移する。

7. **ツリーセル（TreeCell）**
   - 説明: ランチャーに登録されているすべてのグループへアクセスするためのセル。必ず1つ以上存在し、削除不可。
   - 挙動: クリックでグループ一覧（ツリー表示）を開き、任意のグループへ直接ジャンプできる。

### 2) 制約・配置ルール
- 必須セル（設定、閉じる、戻る、ツリー）は削除不可だが移動は可能。どの階層にも必ず1つ以上存在。
- 一つの階層には最大30セルを登録可能。
- 座標系：cube (x, y, z), x+y+z = 0。整数座標。

### 3) 辺クリックでの追加アルゴリズム
- **新規セルの追加は、セルの未接続の辺をクリックする場合のみ**とする。
- ドラッグ＆ドロップによる新規追加は行わない（既存セルへの登録のみ）。

### 4) ランチャー設定画面
#### 高レベル UI 構成
- 一覧トップバー（タイトル、検索、保存ボタン、適用ボタン、リセット）
- タブ／サイドメニュー:
  1. **一般 (General)**: 起動時動作、表示位置、フォーカス、最大表示セル数（固定30）。
  2. **表示 / テーマ (Appearance)**: テーマ、UI密度、アニメーション、ラベル表示、アイコンサイズ。
  3. **操作 / キー割当 (Behavior & Hotkeys)**: グローバルホットキー、辺クリック感度、キーナビゲーション。
  4. **セルとグループ管理 (Cells & Groups)**: ショートカットリスト、詳細エディタ、一括操作。
  5. **永続化 / インポート・エクスポート (Persistence & Sync)**: 保存先、自動バックアップ、JSONインポート/エクスポート。
  6. **セキュリティ / 実行設定 (Security)**: 危険拡張子警告、管理者権限設定。
  7. **高度な設定 / デバッグ (Advanced & Diagnostics)**: ログレベル、診断ツール。
  8. **ヘルプ / バージョン情報 (Help & About)**: バージョン情報、チュートリアル。

### 5) ショートカット解決・起動
- .lnk: IShellLink 等で解決し targetPath, arguments, workingDirectory を取得。
- UWP: AUMID を保存し起動。
- URI: プロトコル起動。

### 6) アイコン抽出・キャッシュ
- ディスクキャッシュ（%APPDATA%）＋メモリ LRU キャッシュ。非同期抽出。

### 7) 永続化（JSON）
- settings.json に保存。原子的保存（tmp→rename）。

### 8) 実装技術
- Tauri (React + TypeScript + Rust)